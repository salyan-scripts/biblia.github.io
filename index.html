<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>B√≠blia Pro</title>
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Pro:wght@400;600&family=Inter:wght@400;600&family=Lato:wght@400;700&family=Merriweather:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #ffffff; --text: #2c3e50; --panel: #f8f9fa; --border: #e1e4e8; --accent: #2980b9;
            --font-main: 'Inter', sans-serif;
            --font-size: 18px;
        }
        [data-theme="dark"] {
            --bg: #1a1a1a; --text: #ecf0f1; --panel: #2c3e50; --border: #444; --accent: #3498db;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; background: var(--bg); color: var(--text); font-family: var(--font-main); padding-bottom: 80px; }

        /* --- HEADER --- */
        header {
            position: sticky; top: 0; background: var(--bg); border-bottom: 1px solid var(--border);
            padding: 10px 15px; display: flex; gap: 10px; align-items: center; z-index: 100; box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .search-bar {
            flex: 1; padding: 8px 12px; border-radius: 20px; border: 1px solid var(--border);
            background: var(--panel); color: var(--text); font-size: 16px; outline: none;
        }

        .icon-btn {
            background: none; border: none; font-size: 1.4rem; cursor: pointer; color: var(--text); padding: 5px;
        }

        /* --- CONTE√öDO --- */
        main { max-width: 900px; margin: 0 auto; padding: 20px 15px; }

        .verse-block {
            padding: 8px 0; margin-bottom: 5px; border-radius: 8px; cursor: pointer; transition: background 0.2s;
            font-size: var(--font-size); line-height: 1.6;
        }
        .verse-block:hover { background: var(--panel); }
        
        .v-num { font-size: 0.7em; font-weight: bold; color: var(--accent); margin-right: 8px; vertical-align: super; }
        .version-tag { font-size: 0.6em; text-transform: uppercase; background: var(--border); padding: 2px 4px; border-radius: 4px; margin-right: 5px; color: var(--text); opacity: 0.7; }
        
        .nvi-text { color: #7f8c8d; margin-top: 5px; display: block; }
        [data-theme="dark"] .nvi-text { color: #bdc3c7; }

        /* --- BARRA DE NAVEGA√á√ÉO INFERIOR --- */
        .bottom-nav {
            position: fixed; bottom: 0; left: 0; width: 100%; background: var(--bg);
            border-top: 1px solid var(--border); padding: 10px; display: flex; justify-content: center; gap: 15px;
            z-index: 100; box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
        }
        
        .nav-btn {
            background: var(--panel); border: 1px solid var(--border); color: var(--text);
            padding: 10px 15px; border-radius: 8px; font-weight: bold; cursor: pointer; flex: 1; max-width: 60px;
        }
        .nav-btn:active { background: var(--accent); color: white; }

        /* --- MENU DE CONFIGURA√á√ïES (MODAL) --- */
        .modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5);
            display: none; justify-content: center; align-items: flex-end; z-index: 2000;
        }
        .modal-content {
            background: var(--bg); width: 100%; max-width: 600px; border-radius: 20px 20px 0 0; padding: 25px;
            animation: slideUp 0.3s ease; max-height: 80vh; overflow-y: auto;
        }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }

        .setting-group { margin-bottom: 20px; }
        .setting-label { display: block; font-weight: bold; margin-bottom: 10px; font-size: 0.9rem; color: var(--accent); }
        
        .btn-group { display: flex; gap: 10px; flex-wrap: wrap; }
        .option-btn {
            padding: 8px 15px; border: 1px solid var(--border); border-radius: 20px; background: var(--panel);
            color: var(--text); cursor: pointer; font-size: 0.9rem; flex: 1; text-align: center;
        }
        .option-btn.active { background: var(--accent); color: white; border-color: var(--accent); }

        /* Toast Notification */
        #toast {
            position: fixed; bottom: 80px; left: 50%; transform: translateX(-50%);
            background: #333; color: white; padding: 10px 20px; border-radius: 20px;
            font-size: 14px; opacity: 0; transition: opacity 0.3s; pointer-events: none; z-index: 3000;
        }

        /* Loading */
        .loading { text-align: center; padding: 20px; color: var(--accent); display: none; }
    </style>
</head>
<body>

<header>
    <div style="font-weight:bold; cursor:pointer;" onclick="toggleMenu()">‚ò∞ <span id="header-title">G√™nesis 1</span></div>
    <input type="text" id="search-input" class="search-bar" placeholder="Buscar (ex: Jo√£o 3:16)">
    <button class="icon-btn" onclick="doSearch()">üîç</button>
    <button class="icon-btn" onclick="openSettings()">‚öôÔ∏è</button>
</header>

<main id="content">
    <div class="loading" id="loader">Carregando B√≠blia...</div>
</main>

<div id="toast">Vers√≠culo copiado!</div>

<div class="bottom-nav">
    <button class="nav-btn" onclick="nav('prevBook')">&lt;&lt;</button>
    <button class="nav-btn" onclick="nav('prevChap')">&lt;</button>
    <button class="nav-btn" onclick="nav('nextChap')">&gt;</button>
    <button class="nav-btn" onclick="nav('nextBook')">&gt;&gt;</button>
</div>

<div id="settings-modal" class="modal" onclick="closeSettings(event)">
    <div class="modal-content" onclick="event.stopPropagation()">
        
        <div class="setting-group">
            <span class="setting-label">VERS√ÉO DA B√çBLIA</span>
            <div class="btn-group">
                <button class="option-btn" onclick="setVersion('acf')" id="btn-acf">ACF</button>
                <button class="option-btn" onclick="setVersion('nvi')" id="btn-nvi">NVI</button>
                <button class="option-btn" onclick="setVersion('dual')" id="btn-dual">Comparar</button>
            </div>
        </div>

        <div class="setting-group">
            <span class="setting-label">MODO DE LEITURA</span>
            <div class="btn-group">
                <button class="option-btn active" onclick="setViewMode('chapter')" id="btn-mode-chap">Cap√≠tulo</button>
                <button class="option-btn" onclick="setViewMode('book')" id="btn-mode-book">Livro Todo</button>
            </div>
        </div>

        <div class="setting-group">
            <span class="setting-label">TAMANHO DA FONTE</span>
            <div class="btn-group">
                <button class="option-btn" onclick="changeSize(-2)">A-</button>
                <button class="option-btn" onclick="resetSize()">Padr√£o</button>
                <button class="option-btn" onclick="changeSize(2)">A+</button>
            </div>
        </div>

        <div class="setting-group">
            <span class="setting-label">TIPO DE FONTE</span>
            <div class="btn-group">
                <button class="option-btn" style="font-family: 'Inter'" onclick="setFont('Inter')">Padr√£o</button>
                <button class="option-btn" style="font-family: 'Crimson Pro'" onclick="setFont('Crimson Pro')">Cl√°ssica</button>
                <button class="option-btn" style="font-family: 'Merriweather'" onclick="setFont('Merriweather')">Gordinha</button>
                <button class="option-btn" style="font-family: 'Lato'" onclick="setFont('Lato')">Moderna</button>
            </div>
        </div>

        <div class="setting-group">
            <span class="setting-label">TEMA</span>
            <div class="btn-group">
                <button class="option-btn" onclick="setTheme('light')">Dia ‚òÄÔ∏è</button>
                <button class="option-btn" onclick="setTheme('dark')">Noite üåô</button>
            </div>
        </div>

        <button class="option-btn" style="width:100%; background:#e74c3c; color:white; border:none; margin-top:10px" onclick="closeSettings(null, true)">Fechar</button>
    </div>
</div>

<script>
    // --- DADOS E ESTADO ---
    let bible = { acf: [], nvi: [] };
    let state = {
        book: 0,
        chapter: 0,
        version: 'acf', // acf, nvi, dual
        viewMode: 'chapter', // chapter, book
        fontSize: 18,
        fontFamily: 'Inter',
        theme: 'light'
    };

    const bookNames = ["G√™nesis","√äxodo","Lev√≠tico","N√∫meros","Deuteron√¥mio","Josu√©","Ju√≠zes","Rute","1 Samuel","2 Samuel","1 Reis","2 Reis","1 Cr√¥nicas","2 Cr√¥nicas","Esdras","Neemias","Ester","J√≥","Salmos","Prov√©rbios","Eclesiastes","Cantares","Isa√≠as","Jeremias","Lamenta√ß√µes","Ezequiel","Daniel","Os√©ias","Joel","Am√≥s","Obadias","Jonas","Miqu√©ias","Naum","Habacuque","Sofonias","Ageu","Zacarias","Malaquias","Mateus","Marcos","Lucas","Jo√£o","Atos","Romanos","1 Cor√≠ntios","2 Cor√≠ntios","G√°latas","Ef√©sios","Filipenses","Colossenses","1 Tessalonicenses","2 Tessalonicenses","1 Tim√≥teo","2 Tim√≥teo","Tito","Filemon","Hebreus","Tiago","1 Pedro","2 Pedro","1 Jo√£o","2 Jo√£o","3 Jo√£o","Judas","Apocalipse"];
    
    // Mapeamento de abrevia√ß√µes para √≠ndice
    const abbrevMap = {}; 

    // --- INICIALIZA√á√ÉO ---
    async function init() {
        document.getElementById('loader').style.display = 'block';
        try {
            const [r1, r2] = await Promise.all([fetch('acf.json'), fetch('nvi.json')]);
            bible.acf = await r1.json();
            bible.nvi = await r2.json();
            
            // Popula mapa de abrevia√ß√µes
            bible.acf.forEach((b, i) => {
                abbrevMap[b.abbrev.toLowerCase()] = i;
                abbrevMap[bookNames[i].toLowerCase()] = i; // Mapeia nome completo tamb√©m
            });

            loadState();
            applySettings();
            render();
        } catch(e) {
            alert("Erro ao carregar arquivos JSON. Verifique se est√£o na pasta.");
        }
        document.getElementById('loader').style.display = 'none';
    }

    // --- RENDERIZA√á√ÉO ---
    function render() {
        const content = document.getElementById('content');
        const b = bible.acf[state.book]; // Refer√™ncia para pegar tamanho
        const title = document.getElementById('header-title');
        
        // Atualiza T√≠tulo
        title.innerText = state.viewMode === 'book' 
            ? bookNames[state.book] 
            : `${bookNames[state.book]} ${state.chapter + 1}`;

        let html = '';
        
        // Define quantos cap√≠tulos renderizar
        let startChap = state.viewMode === 'book' ? 0 : state.chapter;
        let endChap = state.viewMode === 'book' ? b.chapters.length : state.chapter + 1;

        for (let c = startChap; c < endChap; c++) {
            if (state.viewMode === 'book') html += `<h3 style="margin-top:30px; border-bottom:1px solid #ddd">Cap√≠tulo ${c+1}</h3>`;
            
            const chapACF = bible.acf[state.book].chapters[c];
            const chapNVI = bible.nvi[state.book].chapters[c];

            chapACF.forEach((vText, vIndex) => {
                let verseHTML = `<div class="verse-block" onclick="copyVerse(this, '${bookNames[state.book]} ${c+1}:${vIndex+1}')">`;
                
                // Vers√£o Principal (ou ACF no Dual)
                if (state.version === 'acf' || state.version === 'dual') {
                    verseHTML += `<div><span class="v-num">${vIndex + 1}</span>`;
                    if(state.version === 'dual') verseHTML += `<span class="version-tag">ACF</span>`;
                    verseHTML += `${vText}</div>`;
                }

                // Vers√£o NVI
                if (state.version === 'nvi' || state.version === 'dual') {
                    if (state.version === 'nvi') verseHTML += `<div><span class="v-num">${vIndex + 1}</span>${chapNVI[vIndex]}</div>`;
                    else verseHTML += `<div class="nvi-text"><span class="version-tag">NVI</span>${chapNVI[vIndex] || ''}</div>`;
                }
                
                verseHTML += `</div>`;
                html += verseHTML;
            });
        }

        // Bot√£o Continuar Lento (Pr√≥ximo Cap√≠tulo)
        if(state.viewMode === 'chapter') {
            html += `<button onclick="nav('nextChap')" style="width:100%; padding:15px; margin-top:20px; background:var(--panel); border:1px solid var(--border); border-radius:10px; font-size:1rem;">Carregar Pr√≥ximo Cap√≠tulo ‚¨á</button>`;
        }

        content.innerHTML = html;
        window.scrollTo(0, 0);
        saveState();
        updateUIControls();
    }

    // --- NAVEGA√á√ÉO ---
    function nav(action) {
        const totalBooks = bible.acf.length;
        const totalChaps = bible.acf[state.book].chapters.length;

        if (action === 'nextChap') {
            if (state.chapter < totalChaps - 1) state.chapter++;
            else if (state.book < totalBooks - 1) { state.book++; state.chapter = 0; }
        } else if (action === 'prevChap') {
            if (state.chapter > 0) state.chapter--;
            else if (state.book > 0) { state.book--; state.chapter = bible.acf[state.book].chapters.length - 1; }
        } else if (action === 'nextBook') {
            if (state.book < totalBooks - 1) { state.book++; state.chapter = 0; }
        } else if (action === 'prevBook') {
            if (state.book > 0) { state.book--; state.chapter = 0; }
        }
        render();
    }

    // --- BUSCA ---
    function doSearch() {
        const input = document.getElementById('search-input').value.toLowerCase().trim();
        // Regex para capturar: (Livro) (Capitulo)(Separador)(Versiculo opcional)
        // Ex: "joao 3", "gn 1:1", "1 pedro 2"
        const match = input.match(/(\d?\s?[a-z√ß√£√µ√™√≠√≥√∫]+)\s+(\d+)(?:[:\.](\d+))?/);

        if (match) {
            let bookName = match[1].trim();
            let chap = parseInt(match[2]) - 1;
            let verse = match[3] ? parseInt(match[3]) : null;

            // Tenta achar o livro pelo nome ou abrevia√ß√£o
            let bookIdx = -1;
            // Busca exata primeiro
            if (abbrevMap[bookName] !== undefined) bookIdx = abbrevMap[bookName];
            else {
                // Busca parcial (ex: "mat" acha "mateus")
                for (let key in abbrevMap) {
                    if (key.startsWith(bookName)) { bookIdx = abbrevMap[key]; break; }
                }
            }

            if (bookIdx !== -1) {
                state.book = bookIdx;
                // Valida cap√≠tulo
                const maxChap = bible.acf[bookIdx].chapters.length;
                if (chap >= 0 && chap < maxChap) {
                    state.chapter = chap;
                    state.viewMode = 'chapter';
                    render();
                    if(verse) alert(`Navegamos para o cap√≠tulo. Role para o vers√≠culo ${verse}.`); // Simples scroll visual
                } else {
                    alert(`Este livro s√≥ tem ${maxChap} cap√≠tulos.`);
                }
            } else {
                alert("Livro n√£o encontrado. Tente 'Jo√£o 3' ou 'Gn 1'");
            }
        }
    }

    // --- CONFIGURA√á√ïES E UTILIT√ÅRIOS ---
    function openSettings() { document.getElementById('settings-modal').style.display = 'flex'; }
    function closeSettings(e, force) { 
        if(force || e.target.id === 'settings-modal') document.getElementById('settings-modal').style.display = 'none'; 
    }

    function setVersion(v) { state.version = v; updateUIControls(); render(); }
    function setViewMode(m) { state.viewMode = m; updateUIControls(); render(); }
    function setTheme(t) { state.theme = t; document.body.setAttribute('data-theme', t); saveState(); }
    
    function setFont(f) { 
        state.fontFamily = f; 
        document.documentElement.style.setProperty('--font-main', f + ', sans-serif');
        saveState();
    }
    
    function changeSize(delta) {
        state.fontSize += delta;
        document.documentElement.style.setProperty('--font-size', state.fontSize + 'px');
        saveState();
    }
    function resetSize() { state.fontSize = 18; changeSize(0); }

    function updateUIControls() {
        // Atualiza bot√µes ativos no modal
        document.querySelectorAll('.option-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(`btn-${state.version}`).classList.add('active');
        document.getElementById(`btn-mode-${state.viewMode === 'book' ? 'book' : 'chap'}`).classList.add('active');
    }

    function copyVerse(el, ref) {
        const text = el.innerText.replace(/ACF|NVI/g, '').replace(/\n/g, ' ').replace(/\s+/g, ' ').trim();
        navigator.clipboard.writeText(`${text} (${ref})`);
        
        const toast = document.getElementById('toast');
        toast.style.opacity = 1;
        setTimeout(() => toast.style.opacity = 0, 2000);
    }

    // --- STATE MANAGEMENT ---
    function saveState() {
        localStorage.setItem('bibleState_v3', JSON.stringify(state));
    }
    function loadState() {
        const saved = JSON.parse(localStorage.getItem('bibleState_v3'));
        if (saved) {
            state = { ...state, ...saved };
            // Aplica configs visuais
            document.body.setAttribute('data-theme', state.theme);
            document.documentElement.style.setProperty('--font-size', state.fontSize + 'px');
            document.documentElement.style.setProperty('--font-main', state.fontFamily + ', sans-serif');
        }
    }
    function applySettings() { updateUIControls(); }

    init();
</script>
</body>
</html>
