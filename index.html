<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>B√≠blia Digital V5</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Pro:wght@400;700&family=Inter:wght@400;700&family=Lato:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg: #ffffff; --text: #1a1a1a; --panel: #f1f3f5; --border: #dee2e6; --accent: #007bff;
            --font-size: 18px; --font-family: 'Inter', sans-serif;
        }
        [data-theme="dark"] {
            --bg: #121212; --text: #e9ecef; --panel: #2b2f33; --border: #3d4246; --accent: #339af0;
        }

        body { 
            margin: 0; background: var(--bg); color: var(--text); 
            font-family: var(--font-family); font-size: var(--font-size);
            transition: background 0.3s; padding-bottom: 90px;
        }

        header {
            position: sticky; top: 0; background: var(--bg); border-bottom: 1px solid var(--border);
            padding: 10px 15px; display: flex; gap: 10px; align-items: center; z-index: 1000;
        }
        .search-box {
            flex: 1; display: flex; background: var(--panel); border-radius: 20px; padding: 5px 15px; border: 1px solid var(--border);
        }
        .search-box input {
            border: none; background: none; color: var(--text); outline: none; width: 100%; font-size: 16px;
        }
        .icon-btn { background: none; border: none; font-size: 1.3rem; cursor: pointer; color: var(--text); }

        main { max-width: 800px; margin: 0 auto; padding: 20px; min-height: 70vh; }
        .verse-row { padding: 10px; border-radius: 8px; cursor: pointer; border-bottom: 1px solid var(--border); }
        .verse-row:hover { background: var(--panel); }
        .v-num { font-weight: bold; color: var(--accent); font-size: 0.8em; margin-right: 10px; vertical-align: super; }
        .nvi-text { display: block; margin-top: 5px; opacity: 0.7; font-size: 0.95em; }

        footer { max-width: 800px; margin: 30px auto; padding: 20px; border-top: 2px solid var(--border); }
        .book-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 8px; }
        .book-btn { background: var(--panel); border: 1px solid var(--border); padding: 8px; border-radius: 6px; text-align: center; cursor: pointer; font-size: 0.85rem; color: var(--text); }

        .nav-bar { position: fixed; bottom: 0; left: 0; width: 100%; background: var(--bg); border-top: 1px solid var(--border); padding: 10px; display: flex; justify-content: center; gap: 8px; z-index: 1000; }
        .nav-item { flex: 1; max-width: 70px; padding: 12px; border: 1px solid var(--border); background: var(--panel); border-radius: 8px; text-align: center; font-weight: bold; cursor: pointer; }

        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.6); display: none; justify-content: center; align-items: flex-end; z-index: 2000; }
        .modal-content { background: var(--bg); width: 100%; max-width: 500px; padding: 20px; border-radius: 20px 20px 0 0; }
        .opt-row { margin-bottom: 15px; }
        .opt-title { font-size: 0.8rem; font-weight: bold; color: var(--accent); display: block; margin-bottom: 8px; }
        .btn-group { display: flex; gap: 5px; flex-wrap: wrap; }
        .btn-group button { flex: 1; padding: 10px; border: 1px solid var(--border); border-radius: 10px; background: var(--panel); color: var(--text); cursor: pointer; }
        .btn-group button.active { background: var(--accent); color: white; }

        #toast { position: fixed; bottom: 100px; left: 50%; transform: translateX(-50%); background: #333; color: white; padding: 8px 20px; border-radius: 20px; opacity: 0; transition: 0.3s; pointer-events: none; }
    </style>
</head>
<body data-theme="light">

<header>
    <div onclick="window.scrollTo(0, document.body.scrollHeight)" style="cursor:pointer; font-weight:bold; min-width: 100px;">
        üìñ <span id="cur-ref">G√™nesis 1</span>
    </div>
    <div class="search-box">
        <input type="text" id="inp-search" placeholder="Ex: Jo√£o 3:16" autocomplete="off">
        <button class="icon-btn" onclick="doSearch()">üîç</button>
    </div>
    <button class="icon-btn" onclick="toggleModal(true)">‚öôÔ∏è</button>
</header>

<main id="bible-box">
    <div style="text-align:center; padding:50px;">A carregar B√≠blia...</div>
</main>

<footer>
    <h3 style="text-align:center">Livros da B√≠blia</h3>
    <div class="book-grid" id="footer-books"></div>
</footer>

<div class="nav-bar">
    <div class="nav-item" onclick="navigate('pb')" title="Livro Anterior">¬´</div>
    <div class="nav-item" onclick="navigate('pc')" title="Cap√≠tulo Anterior">‚Äπ</div>
    <div class="nav-item" onclick="navigate('nc')" title="Pr√≥ximo Cap√≠tulo">‚Ä∫</div>
    <div class="nav-item" onclick="navigate('nb')" title="Pr√≥ximo Livro">¬ª</div>
</div>

<div id="cfg-modal" class="modal" onclick="toggleModal(false)">
    <div class="modal-content" onclick="event.stopPropagation()">
        <div class="opt-row">
            <span class="opt-title">VERS√ÉO</span>
            <div class="btn-group">
                <button id="v-acf" onclick="setVer('acf')">ACF</button>
                <button id="v-nvi" onclick="setVer('nvi')">NVI</button>
                <button id="v-dual" onclick="setVer('dual')">Ambas</button>
            </div>
        </div>
        <div class="opt-row">
            <span class="opt-title">FONTE</span>
            <div class="btn-group">
                <button id="f-Inter" style="font-family:'Inter'" onclick="setFnt('Inter')">Padr√£o</button>
                <button id="f-Crimson" style="font-family:'Crimson Pro'" onclick="setFnt('Crimson Pro')">Jornal</button>
                <button id="f-Lato" style="font-family:'Lato'" onclick="setFnt('Lato')">Moderna</button>
            </div>
        </div>
        <div class="opt-row">
            <span class="opt-title">TAMANHO</span>
            <div class="btn-group">
                <button onclick="chSize(-2)">A -</button>
                <button onclick="chSize(0)">Normal</button>
                <button onclick="chSize(2)">A +</button>
            </div>
        </div>
        <div class="opt-row">
            <span class="opt-title">TEMA</span>
            <div class="btn-group">
                <button onclick="setThm('light')">‚òÄÔ∏è Dia</button>
                <button onclick="setThm('dark')">üåô Noite</button>
            </div>
        </div>
        <button onclick="toggleModal(false)" style="width:100%; padding:12px; border:none; background:var(--accent); color:white; border-radius:10px; margin-top:10px; font-weight:bold;">OK</button>
    </div>
</div>

<div id="toast">Copiado!</div>

<script>
    let data = { acf: [], nvi: [] };
    let cfg = { b: 0, c: 0, v: 'acf', f: 'Inter', s: 18, t: 'light' };
    const bNames = ["G√™nesis","√äxodo","Lev√≠tico","N√∫meros","Deuteron√¥mio","Josu√©","Ju√≠zes","Rute","1 Samuel","2 Samuel","1 Reis","2 Reis","1 Cr√¥nicas","2 Cr√¥nicas","Esdras","Neemias","Ester","J√≥","Salmos","Prov√©rbios","Eclesiastes","Cantares","Isa√≠as","Jeremias","Lamenta√ß√µes","Ezequiel","Daniel","Os√©ias","Joel","Am√≥s","Obadias","Jonas","Miqu√©ias","Naum","Habacuque","Sofonias","Ageu","Zacarias","Malaquias","Mateus","Marcos","Lucas","Jo√£o","Atos","Romanos","1 Cor√≠ntios","2 Cor√≠ntios","G√°latas","Ef√©sios","Filipenses","Colossenses","1 Tessalonicenses","2 Tessalonicenses","1 Tim√≥teo","2 Tim√≥teo","Tito","Filemon","Hebreus","Tiago","1 Pedro","2 Pedro","1 Jo√£o","2 Jo√£o","3 Jo√£o","Judas","Apocalipse"];

    async function init() {
        try {
            const [r1, r2] = await Promise.all([fetch('acf.json'), fetch('nvi.json')]);
            data.acf = await r1.json();
            data.nvi = await r2.json();
            
            const saved = JSON.parse(localStorage.getItem('biblia_cfg_v5'));
            if(saved) cfg = {...cfg, ...saved};
            
            // Adicionar evento de Enter no input
            document.getElementById('inp-search').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') { doSearch(); }
            });

            renderBooks();
            applyCfg();
            draw();
        } catch(e) { document.getElementById('bible-box').innerHTML = "Erro ao carregar arquivos JSON."; }
    }

    function draw() {
        const box = document.getElementById('bible-box');
        const b = data.acf[cfg.b];
        document.getElementById('cur-ref').innerText = `${bNames[cfg.b]} ${cfg.c + 1}`;
        
        let html = '';
        const chA = b.chapters[cfg.c];
        const chN = data.nvi[cfg.b].chapters[cfg.c];

        chA.forEach((v, i) => {
            html += `<div class="verse-row" onclick="copyVerse(this, '${bNames[cfg.b]} ${cfg.c+1}:${i+1}')">`;
            if(cfg.v === 'acf' || cfg.v === 'dual') {
                html += `<div><span class="v-num">${i+1}</span>${v}</div>`;
            }
            if(cfg.v === 'nvi' || cfg.v === 'dual') {
                const txt = chN[i] || '';
                html += `<div class="nvi-text">${cfg.v === 'dual' ? '<b>NVI:</b> ' : ''}${txt}</div>`;
            }
            html += `</div>`;
        });

        box.innerHTML = html;
        window.scrollTo(0,0);
        localStorage.setItem('biblia_cfg_v5', JSON.stringify(cfg));
    }

    function doSearch() {
        const input = document.getElementById('inp-search');
        const query = input.value.trim().toLowerCase();
        if (!query) return;

        // Regex para pegar (Nome do Livro) (Capitulo)
        const match = query.match(/(\d?\s?[a-z√ß√£√µ√™√≠√≥√∫]+)\s+(\d+)/);
        
        if (match) {
            const searchedBook = match[1].trim();
            const searchedChap = parseInt(match[2]) - 1;

            const bIdx = bNames.findIndex(name => 
                name.toLowerCase() === searchedBook || 
                name.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "").startsWith(searchedBook)
            );

            if (bIdx !== -1 && searchedChap >= 0 && searchedChap < data.acf[bIdx].chapters.length) {
                cfg.b = bIdx;
                cfg.c = searchedChap;
                draw();
                input.blur(); // Esconde o teclado no celular
            } else {
                alert("Livro ou cap√≠tulo n√£o encontrado.");
            }
        } else {
            alert("Use o formato: Livro Cap√≠tulo (Ex: Jo√£o 3)");
        }
    }

    function navigate(op) {
        const b = data.acf[cfg.b];
        if(op==='nc') { 
            if(cfg.c < b.chapters.length-1) cfg.c++; 
            else if(cfg.b < 65) { cfg.b++; cfg.c=0; }
        }
        else if(op==='pc') {
            if(cfg.c > 0) cfg.c--;
            else if(cfg.b > 0) { cfg.b--; cfg.c = data.acf[cfg.b].chapters.length-1; }
        }
        else if(op==='nb') { if(cfg.b < 65) { cfg.b++; cfg.c=0; } }
        else if(op==='pb') { if(cfg.b > 0) { cfg.b--; cfg.c=0; } }
        draw();
    }

    function renderBooks() {
        document.getElementById('footer-books').innerHTML = bNames.map((n, i) => 
            `<div class="book-btn" onclick="cfg.b=${i}; cfg.c=0; draw();">${n}</div>`
        ).join('');
    }

    function copyVerse(el, ref) {
        const t = el.innerText.replace(/NVI:/g, '').replace(/\s+/g, ' ').trim();
        navigator.clipboard.writeText(`${t} (${ref})`);
        const toast = document.getElementById('toast');
        toast.style.opacity = 1; setTimeout(() => toast.style.opacity = 0, 2000);
    }

    function toggleModal(s) { document.getElementById('cfg-modal').style.display = s ? 'flex' : 'none'; }
    function setVer(v) { cfg.v = v; draw(); }
    function setThm(t) { cfg.t = t; applyCfg(); }
    function setFnt(f) { cfg.f = f; applyCfg(); }
    function chSize(d) { if(d===0) cfg.s=18; else cfg.s+=d; applyCfg(); }

    function applyCfg() {
        document.body.setAttribute('data-theme', cfg.t);
        document.documentElement.style.setProperty('--font-size', cfg.s + 'px');
        document.documentElement.style.setProperty('--font-family', cfg.f === 'Inter' ? "'Inter', sans-serif" : (cfg.f === 'Crimson Pro' ? "'Crimson Pro', serif" : `'${cfg.f}', sans-serif`));
        
        document.querySelectorAll('.btn-group button').forEach(b => b.classList.remove('active'));
        document.getElementById('v-'+cfg.v).classList.add('active');
        localStorage.setItem('biblia_cfg_v5', JSON.stringify(cfg));
    }

    init();
</script>
</body>
</html>